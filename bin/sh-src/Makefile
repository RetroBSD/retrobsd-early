TOPSRC		= $(shell cd ../..; pwd)
include $(TOPSRC)/target.mk

CFLAGS		= -O -Werror

SRCS		= args.c blok.c builtin.c cmd.c ctype.c error.c expand.c \
		  fault.c io.c macro.c main.c msg.c name.c print.c service.c \
		  setbrk.c stak.c string.c word.c xec.c
OBJS		= args.o blok.o builtin.o cmd.o ctype.o error.o expand.o \
		  fault.o io.o macro.o main.o msg.o name.o print.o service.o \
		  setbrk.o stak.o string.o word.o xec.o

all:		../sh

../sh:		${OBJS}
		${CC} ${LDFLAGS} -o sh.elf ${OBJS} ${LIBS}
		${OBJDUMP} -S sh.elf > sh.dis
		${SIZE} sh.elf
		${ELF2AOUT} sh.elf $@

install:	all
		install -s ../sh $(DESTDIR)/bin
clean:
		rm -f ../sh *.o *~ *.elf

args.o: args.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
blok.o: blok.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
builtin.o: builtin.c
cmd.o: cmd.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h sym.h
ctype.o: ctype.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
error.o: error.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
expand.o: expand.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
fault.o: fault.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
io.o: io.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
macro.o: macro.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h sym.h
main.o: main.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h sym.h timeout.h
msg.o: msg.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h sym.h
name.o: name.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
print.o: print.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
service.o: service.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
setbrk.o: setbrk.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
stak.o: stak.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
string.o: string.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h
word.o: word.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h sym.h
xec.o: xec.c defs.h mac.h mode.h name.h stak.h brkincr.h ctype.h sym.h
